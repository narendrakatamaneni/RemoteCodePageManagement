<DOCTYPE !HTML>
<html>
  <head>
    <Title>CsMessage.h</Title>
    <style>
      body {
        padding:15px 40px;
        font-family: Consolas;
        font-size: 1.25em;
        font-weight: normal;
      }
      </style>
  <link rel = "stylesheet" type = "text/css" href = "style.css" >
  <script src="script.js"> </script> 
  </head>

  <body>
 <input type ="submit" value= "Comments" id ="cmt" onclick="togglevisibility('comments')" ></input>
 <input type ="submit" value= "Class"  id ="cls" onclick="togglevisibility('clsClass')" ></input>
 <input type ="submit" value= "Function" id ="fun" onclick="togglevisibility('funClass')" ></input>
    <pre>
#pragma once
<span class="comments">///////////////////////////////////////////////////////////////////////</span>
<span class="comments">// CsMessage.h - Defines Message type for C# GUI                     //</span>
<span class="comments">// ver 1.0                                                           //</span>
<span class="comments">// Jim Fawcett, CSE687 - Object Oriented Design, Spring 2018         //</span>
<span class="comments">///////////////////////////////////////////////////////////////////////</span>
<span class="comments">/*
*  Package Operations:
* ---------------------
*  This C++\Cli Package contains three classes:
*  - Sutils:      defines methods to convert between managed strings and native strings
*  - CsEndPoint:  defines endpoint structurer, e.g., machineName and port
*  - CsMessage:   defines messages as a collection of attributes.
*
*  Required Files:
* -----------------
*  CsMessage.h, CsMessage.cpp
*
*  Maintenance History:
* ----------------------
*  ver 1.0 : 3/27/2018
*  - first release
*/</span>
#include &lt;string&gt;
#include &lt;iostream&gt;

using namespace System;
using namespace System::Text;
using namespace System::Collections::Generic;

namespace MsgPassingCommunication
{
  using Key = String;
  using Value = String;
  using Attributes = Dictionary&lt;String^, String^&gt;;

  public ref class Sutils
  <span class="clsClass">{
  public:
    static std::string MtoNstr(String^ s);
    static String^ NtoMstr(const std::string& s);
  };
  <span class="comments">//----&lt; convert from managed to native string &gt;----------------------</span></span>

  std::string Sutils::MtoNstr(System::String^ str)
  <span class="funClass">{
    std::string temp;
    for (int i = 0; i &lt; str-&gt;Length; ++i)
    {
      temp.push_back((char)str[i]);
    }
    return temp;
  }</span>
  <span class="comments">//----&lt; convert from native to managed string &gt;----------------------</span>

  String^ Sutils::NtoMstr(const std::string& str)
  <span class="funClass">{
    StringBuilder^ sb = gcnew StringBuilder;
    for (auto ch : str)
    {
      sb-&gt;Append((wchar_t)ch);
    }
    return sb-&gt;ToString();
  }</span>

  public ref class CsEndPoint
  <span class="clsClass">{
  public:
    CsEndPoint()
    <span class="funClass">{
      machineAddress = gcnew String("");
      port = 0;
    }</span>
    property String^ machineAddress;
    property int port;
    static String^ toString(CsEndPoint^ ep);
    static CsEndPoint^ fromString(String^ epStr);
  };
  <span class="comments">//----&lt; convert endpoint to string &gt;---------------------------------</span></span>

  String^ CsEndPoint::toString(CsEndPoint^ ep)
  <span class="funClass">{
    String^ epStr = ep-&gt;machineAddress + ":" + ep-&gt;port.ToString();
    return epStr;
  }</span>
  <span class="comments">//----&lt; convert from string representing endpoint to endpoint &gt;------</span>

  CsEndPoint^ CsEndPoint::fromString(String^ epStr)
  <span class="funClass">{
    CsEndPoint^ ep = gcnew CsEndPoint;
    int pos = epStr-&gt;IndexOf(":");
    ep-&gt;machineAddress = epStr-&gt;Substring(0, pos);
    String^ portStr = epStr-&gt;Substring(pos + 1, epStr-&gt;Length - pos - 1);
    ep-&gt;port = System::Convert::ToInt32(portStr);
    return ep;
  }</span>

  public ref class CsMessage
  <span class="clsClass">{
  public:
    CsMessage() 
    <span class="funClass">{
      attributes = gcnew Attributes;
    }</span>
    CsMessage(CsEndPoint to, CsEndPoint from)
    <span class="funClass">{
      attributes = gcnew Attributes;
      attributes-&gt;Add("to", to.machineAddress + ":" + to.port.ToString());
      attributes-&gt;Add("from", from.machineAddress + ":" + from.port.ToString());
    }</span>
    void add(Key^ key, Value^ value)
    <span class="funClass">{
      attributes-&gt;Add(key, value);
    }</span>
    Value^ value(Key^ key)
    <span class="funClass">{
      return attributes[key];
    }</span>
    bool remove(Key^ key)
    <span class="funClass">{
      if (attributes-&gt;ContainsKey(key))
      {
        attributes-&gt;Remove(key);
        return true;
      }
      return false;
    }</span>
    property Attributes^ attributes;

    void show()
    <span class="funClass">{
      Console::Write("\n  CsMessage:");
      auto enumer = attributes-&gt;GetEnumerator();
      while (enumer.MoveNext())
      {
        String^ key = enumer.Current.Key;
        String^ value = enumer.Current.Value;
        std::cout &lt;&lt; "\n  { " &lt;&lt; Sutils::MtoNstr(key) &lt;&lt; ", " &lt;&lt; Sutils::MtoNstr(value) &lt;&lt; " }";
      }
      Console::Write("\n");
    }</span>
  };
}</span>
    </pre>
  </body>
</html>
