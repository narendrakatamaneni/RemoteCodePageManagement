<DOCTYPE !HTML>
<html>
  <head>
    <Title>Loader.cpp</Title>
    <style>
      body {
        padding:15px 40px;
        font-family: Consolas;
        font-size: 1.25em;
        font-weight: normal;
      }
      </style>
  <link rel = "stylesheet" type = "text/css" href = "style.css" >
  <script src="script.js"> </script> 
  </head>

  <body>
 <input type ="submit" value= "Comments" id ="cmt" onclick="togglevisibility('comments')" ></input>
 <input type ="submit" value= "Class"  id ="cls" onclick="togglevisibility('clsClass')" ></input>
 <input type ="submit" value= "Function" id ="fun" onclick="togglevisibility('funClass')" ></input>
    <h3>Dependencies: 
      <a href="Loader.h.html">Loader.h</a><br/>
      <a href="Logger.h.html">Logger.h</a><br/>
      <a href="StringUtilities.h.html">StringUtilities.h</a><br/>
      <a href="CodeUtilities.h.html">CodeUtilities.h</a><br/>
    </h3>    <pre>
<div class="comments">/////////////////////////////////////////////////////////////////////</div>
<div class="comments">// DirExplorerN.cpp - Naive directory explorer                     //</div>
<div class="comments">// ver 1.2                                                         //</div>
<div class="comments">// Narendra Katamaneni, CSE687 - Object Oriented Design, Fall 2018         //</div>
<div class="comments">/////////////////////////////////////////////////////////////////////</div>

#include &lt;regex&gt;
#include "Loader.h"
#include "../Logger/Logger.h"

using namespace Logging;
using namespace FileSystem;

<div class="comments">//----&lt; construct DirExplorerN instance with default pattern &gt;-----</div>

Loader::Loader(const std::string& path) : path_(path)
<div class="funClass">{
	patterns_.push_back("*.*");
}</div>
<div class="comments">//----&lt; add specified patterns for selecting file names &gt;----------</div>

void Loader::addPattern(const std::string& patt)
<div class="funClass">{
	if (patterns_.size() == 1 && patterns_[0] == "*.*")
		patterns_.pop_back();
	patterns_.push_back(patt);
}</div>
<div class="comments">//----&lt; set option to recusively walk dir tree &gt;-------------------</div>

void Loader::recurse(bool doRecurse)
<div class="funClass">{
	recurse_ = doRecurse;
}</div>
<div class="comments">//----&lt; start Depth First Search at path held in path_ &gt;-----------</div>

bool Loader::search()
<div class="funClass">{
  LoggerDemo::write("\n  Files found matching patterns:\n");

	find(path_);
  <div class="comments">// found files matching set patterns, return true</div>
  if (files_.size() &gt; 0) return true;
  <div class="comments">// no files found, return false</div>
  return false;
}</div>
<div class="comments">//----&lt; search for directories and their files &gt;-------------------</div>
<div class="comments">/*
  Recursively finds all the dirs and files on the specified path,
  executing doDir when entering a directory and doFile when finding a file
*/</div>
void Loader::find(const std::string& path)
<div class="funClass">{
	<div class="comments">// show current directory</div>

	std::string fpath = Path::getFullFileSpec(path);
	doDir(fpath);

	for (auto patt : patterns_)
	{
		std::vector&lt;std::string&gt; files = Directory::getFiles(fpath, patt);
		for (auto f : files)
		{
			doFile(fpath, f);  <div class="comments">// show each file in current directory</div>
		}
	}

	std::vector&lt;std::string&gt; dirs = Directory::getDirectories(fpath);
	for (auto d : dirs)
	{
		if (d == "." || d == "..")
			continue;
		std::string dpath = fpath + "\\" + d;
		if (recurse_)
		{
			find(dpath);   <div class="comments">// recurse into subdirectories</div>
		}
		else
		{
			doDir(dpath);  <div class="comments">// show subdirectories</div>
		}
	}
}</div>

bool Loader::match_regexes(const std::vector&lt;std::string&gt;& regexes)
<div class="funClass">{
  LoggerDebug::write("\n\n  Matching files to regexes - Available regexes: ");
  LoggerDemo::write("\n\n  Matching files to regexes - Available regexes: ");
  for (auto regex : regexes) {
    LoggerDebug::write(regex + " ");
    LoggerDemo::write(regex + " ");
  }

  LoggerDebug::write("\n  Files found matching regexes: ");
  LoggerDemo::write("\n   Files found matching regexes: ");
  
  std::vector&lt;std::string&gt; filteredFiles; <div class="comments">// to store files matching regex</div>

  <div class="comments">// match regex to files</div>
  for (auto file : files_) {
    std::string filename = Path::getName(file);
    for (auto regex : regexes) {
      std::regex r(regex);
      if (std::regex_match(filename, r)) {
        filteredFiles.push_back(file);
        LoggerDebug::write("\n   -- " + file);
        LoggerDemo::write("\n   -- " + file);
        break; <div class="comments">// break to avoid adding same file twice to the  </div>
               <div class="comments">// list in case it matches multiple regexes</div>
      }
    }
  }

  LoggerDebug::write("\n");
  LoggerDemo::write("\n");

  <div class="comments">// found files matching regex?</div>
  if (filteredFiles.size() &gt; 0) {
    files_ = filteredFiles;
    return true;
  }

  LoggerDebug::write("   -- no files found");
  LoggerDemo::write("   -- no files found");
  <div class="comments">// no matches found</div>
  return false;
}</div>

<div class="comments">//----&lt; an application changes to enable specific file ops &gt;-------</div>
void Loader::doFile(const std::string& dir, const std::string& filename)
<div class="funClass">{
	++fileCount_;
  std::string filepath = dir + "\\" + filename;
  files_.push_back(filepath);
  LoggerDebug::write("\n  --   " + filename);
  LoggerDemo::write("\n  -- " + filepath);
}</div>
<div class="comments">//----&lt; an application changes to enable specific dir ops &gt;--------</div>

void Loader::doDir(const std::string& dirname)
<div class="funClass">{
  ++dirCount_;
  LoggerDebug::write("\n  ++ " + dirname);
}</div>
<div class="comments">//----&lt; return number of files processed &gt;-------------------------</div>

const Loader::files& Loader::filesList() const
<div class="funClass">{
  return files_;
}</div>

size_t Loader::fileCount()
<div class="funClass">{
	return fileCount_;
}</div>
<div class="comments">//----&lt; return number of directories processed &gt;-------------------</div>

size_t Loader::dirCount()
<div class="funClass">{
	return dirCount_;
}</div>
<div class="comments">//----&lt; show final counts for files and dirs &gt;---------------------</div>

void Loader::showStats()
<div class="funClass">{
  std::ostringstream msg;
  msg &lt;&lt; "\n\n  processed " &lt;&lt; fileCount_ &lt;&lt; " files in " &lt;&lt; dirCount_ &lt;&lt;" directories";
  LoggerDebug::write(msg.str());
  LoggerDemo::write(msg.str());
}</div>



#ifdef TEST_DIREXPLORERN  <div class="comments">// only compile the following when defined</div>

#include "../Utilities/StringUtilities/StringUtilities.h"
#include "../Utilities/CodeUtilities/CodeUtilities.h"

using namespace Utilities;

ProcessCmdLine::Usage customUsage()
<div class="funClass">{
  std::string usage;
  usage += "\n  Command Line: path [/option]* [/pattern]*";
  usage += "\n    path is relative or absolute path where processing begins";
  usage += "\n    [/option]* are one or more options of the form:";
  usage += "\n      /s - walk directory recursively";
  usage += "\n      [/demo | /debug] - display mode: either demo OR debug";
  <div class="comments">//usage += "\n      /h - hide empty directories";</div>
  <div class="comments">//usage += "\n      /a - on stopping, show all files in current directory";</div>
  usage += "\n    [pattern]* are one or more pattern strings of the form:";
  usage += "\n      *.h *.cpp *.cs *.txt or *.*";
  usage += "\n";
  return usage;
}</div>

void initializeLoggers(DisplayMode dm) <div class="funClass">{
  if (dm == DisplayMode::Debug) {
    LoggerDebug::attach(&std::cout);
    LoggerDebug::start();
  }

  else if (dm == DisplayMode::Demo) {
    LoggerDemo::attach(&std::cout);
    LoggerDemo::start();
  }
}</div>

void stopLoggers() <div class="funClass">{
  LoggerDemo::stop();
  LoggerDebug::stop();
}</div>

int main(int argc, char *argv[])
<div class="funClass">{
  Title("Demonstrate DirExplorer-Naive, " + Loader::version());

  ProcessCmdLine pcl(argc, argv);
  pcl.usage(customUsage());

  preface("Command Line: ");
  pcl.showCmdLine();
  <div class="comments">//putline();</div>

  if (pcl.parseError())
  {
    pcl.usage();
    std::cout &lt;&lt; "\n\n";
    return 1;
  }

  initializeLoggers(pcl.displayMode());

  Loader de(pcl.path());
  for (auto patt : pcl.patterns())
  {
    de.addPattern(patt);
  }

  if (pcl.hasOption("s"))
  {
    de.recurse();
  }

  bool res = de.search() && de.match_regexes(pcl.regexes());
  de.showStats();

  if (!res) {
    LoggerDemo::write("\n\n  Failed to find any files matching patterns and regexes. Terminating..\n\n");
    return 1; 
  }

  stopLoggers();
  <div class="comments">//std::cout &lt;&lt; "\n\n";</div>
  return 0;
}</div>

#endif
    </pre>
  </body>
</html>
